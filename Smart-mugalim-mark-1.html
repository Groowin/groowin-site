<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Mugalim - –ê“õ—ã–ª–¥—ã –ú“±“ì–∞–ª—ñ–º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        .sidebar-transition {
            transition: all 0.3s ease;
        }
        .qr-container {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .student-name {
            transition: all 0.3s ease;
        }
        .student-confirmed {
            background-color: #10b981 !important;
            color: white !important;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen overflow-hidden">
    <div class="flex h-full">
        <!-- –°–æ–ª –∂–∞“õ –ø–∞–Ω–µ–ª—å -->
        <div class="w-64 bg-gray-900 text-white flex flex-col sidebar-transition">
            <div class="p-4 border-b border-gray-700">
                <h1 class="text-xl font-bold">Smart Mugalim</h1>
                <p class="text-sm text-gray-400">–ê“õ—ã–ª–¥—ã –ú“±“ì–∞–ª—ñ–º –ñ“Ø–π–µ—Å—ñ</p>
            </div>
            
            <nav class="flex-1 p-4 space-y-2">
                <button id="homeBtn" class="w-full flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800 transition-colors">
                    <span class="text-2xl">üè†</span>
                    <span>–ë–∞—Å—Ç—ã –±–µ—Ç</span>
                </button>
                <button id="smartMugalimBtn" class="w-full flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800 transition-colors">
                    <span class="text-2xl">üë®üèª‚Äçüéì</span>
                    <span>Smart Mugalim</span>
                </button>
            </nav>
        </div>

        <!-- –û“£ –∂–∞“õ –∂“±–º—ã—Å –∞–π–º–∞“ì—ã -->
        <div class="flex-1 flex flex-col">
            <!-- –ñ–æ“ì–∞—Ä“ì—ã –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä -->
            <div id="topButtons" class="hidden bg-white border-b border-gray-200 p-4">
                <div class="flex space-x-4">
                    <button id="listBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        –¢—ñ–∑—ñ–º
                    </button>
                    <button id="qrBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        QR
                    </button>
                    <button id="geoBtn" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                        –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
                    </button>
                </div>
            </div>

            <!-- –ñ“±–º—ã—Å –∞–π–º–∞“ì—ã -->
            <div class="flex-1 p-6 overflow-auto">
                <!-- –ë–∞—Å—Ç—ã –±–µ—Ç -->
                <div id="mainContent" class="text-center">
                    <div class="max-w-2xl mx-auto">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Smart Mugalim –∂“Ø–π–µ—Å—ñ–Ω–µ “õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑!</h2>
                        <p class="text-lg text-gray-600 mb-8">–ú“±“ì–∞–ª—ñ–º–¥–µ—Ä “Ø—à—ñ–Ω –∞—Ä–Ω–∞–π—ã –∂–∞—Å–∞–ª“ì–∞–Ω –∞“õ—ã–ª–¥—ã –∂“Ø–π–µ</p>
                        <div class="bg-white rounded-lg shadow-lg p-8">
                            <h3 class="text-xl font-semibold mb-4">–ú“Ø–º–∫—ñ–Ω–¥—ñ–∫—Ç–µ—Ä:</h3>
                            <ul class="text-left space-y-2 text-gray-700">
                                <li>üìù –û“õ—É—à—ã–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ–Ω –±–∞—Å“õ–∞—Ä—É</li>
                                <li>üì± QR –∫–æ–¥ –∞—Ä“õ—ã–ª—ã “õ–∞—Ç—ã—Å—É–¥—ã —Ç–µ–∫—Å–µ—Ä—É</li>
                                <li>üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∞—Ä“õ—ã–ª—ã –±–∞“õ—ã–ª–∞—É</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- –¢—ñ–∑—ñ–º –±–µ—Ç—ñ -->
                <div id="listContent" class="hidden">
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">–û“õ—É—à—ã–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ</h2>
                        
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">–ñ–∞“£–∞ —Å—ã–Ω—ã–ø “õ“±—Ä—É</h3>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">–°—ã–Ω—ã–ø –∞—Ç–∞—É—ã:</label>
                                <input type="text" id="classNameInput" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="–ú—ã—Å–∞–ª—ã: 10–ê —Å—ã–Ω—ã–±—ã">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">–û“õ—É—à—ã–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ (”ô—Ä –∂–æ–ª“ì–∞ –±—ñ—Ä –µ—Å—ñ–º):</label>
                                <textarea id="studentsInput" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="–ê–π–¥–∞—Ä ”ò–ª—ñ–º–æ–≤&#10;–ê—Å–µ–º –ë–µ–∫–æ–≤–∞&#10;–î”ô—É—Ä–µ–Ω –°”ô—Ç–æ–≤&#10;..."></textarea>
                            </div>
                            <div class="flex space-x-4">
                                <button id="saveClassBtn" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                    –°–∞“õ—Ç–∞—É
                                </button>
                                <select id="loadClassSelect" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">–°–∞“õ—Ç–∞–ª“ì–∞–Ω —Å—ã–Ω—ã–ø—Ç—ã —Ç–∞“£–¥–∞—É</option>
                                </select>
                                <button id="loadClassBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    –ñ“Ø–∫—Ç–µ—É
                                </button>
                            </div>
                        </div>

                        <div id="currentClassDisplay" class="hidden bg-white rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold mb-4">–ê“ì—ã–º–¥–∞“ì—ã —Å—ã–Ω—ã–ø: <span id="currentClassName"></span></h3>
                            <div id="studentsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2"></div>
                        </div>
                    </div>
                </div>

                <!-- QR –±–µ—Ç—ñ -->
                <div id="qrContent" class="hidden">
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">QR “ö–∞—Ç—ã—Å—É –¢–µ–∫—Å–µ—Ä—É</h2>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- QR –∫–æ–¥ –±”©–ª—ñ–º—ñ -->
                            <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                                <h3 class="text-lg font-semibold mb-4">–ê“ì—ã–º–¥–∞“ì—ã QR –∫–æ–¥</h3>
                                <div id="qrCodeContainer" class="qr-container mb-4">
                                    <canvas id="qrCanvas" class="mx-auto border-2 border-gray-200 rounded-lg"></canvas>
                                </div>
                                <div class="text-2xl font-bold text-blue-600 mb-2">
                                    “ö–∞–ª“ì–∞–Ω —É–∞“õ—ã—Ç: <span id="timer">15</span> —Å–µ–∫
                                </div>
                                <div class="text-sm text-gray-600">
                                    QR –∫–æ–¥ 15 —Å–µ–∫—É–Ω–¥ —Å–∞–π—ã–Ω –∂–∞“£–∞—Ä–∞–¥—ã
                                </div>
                            </div>

                            <!-- –û“õ—É—à—ã–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ -->
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h3 class="text-lg font-semibold mb-4">–û“õ—É—à—ã–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ</h3>
                                <div id="qrStudentsList" class="grid grid-cols-2 gap-2 max-h-96 overflow-y-auto">
                                    <div class="text-center text-gray-500 col-span-2 py-8">
                                        –ê–ª–¥—ã–º–µ–Ω —Ç—ñ–∑—ñ–º –±–µ—Ç—ñ–Ω–µ–Ω —Å—ã–Ω—ã–ø—Ç—ã –∂“Ø–∫—Ç–µ“£—ñ–∑
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –±–µ—Ç—ñ -->
                <div id="geoContent" class="hidden">
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –±–∞“õ—ã–ª–∞—É</h2>
                        
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">–ê“ì—ã–º–¥–∞“ì—ã –æ—Ä–Ω–∞–ª–∞—Å—É</h3>
                            <div id="locationInfo" class="text-center py-8">
                                <div class="text-4xl mb-4">üìç</div>
                                <p class="text-gray-600">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è–Ω—ã –∞–ª—É “Ø—à—ñ–Ω —Ä“±“õ—Å–∞—Ç –±–µ—Ä—ñ“£—ñ–∑</p>
                                <button id="getLocationBtn" class="mt-4 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    –û—Ä–Ω–∞–ª–∞—Å—É–¥—ã –∞–ª—É
                                </button>
                            </div>
                            <div id="locationDisplay" class="hidden">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-semibold text-gray-700 mb-2">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—Ç–∞—Ä</h4>
                                        <p class="text-sm text-gray-600">–ï–Ω–¥—ñ–∫: <span id="latitude">-</span></p>
                                        <p class="text-sm text-gray-600">–ë–æ–π–ª—ã“õ: <span id="longitude">-</span></p>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-semibold text-gray-700 mb-2">–î”ô–ª–¥—ñ–∫</h4>
                                        <p class="text-sm text-gray-600">–î”ô–ª–¥—ñ–∫: <span id="accuracy">-</span> –º</p>
                                        <p class="text-sm text-gray-600">–£–∞“õ—ã—Ç: <span id="timestamp">-</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold mb-4">–¢—ñ—Ä–∫–µ–ª–≥–µ–Ω –æ“õ—É—à—ã–ª–∞—Ä</h3>
                            <div id="geoStudentsList" class="space-y-2">
                                <div class="text-center text-gray-500 py-8">
                                    QR –∞—Ä“õ—ã–ª—ã —Ç—ñ—Ä–∫–µ–ª–≥–µ–Ω –æ“õ—É—à—ã–ª–∞—Ä –æ—Å—ã–Ω–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR —Å–∫–∞–Ω–µ—Ä —Å–∞–π—Ç—ã (–∂–∞—Å—ã—Ä—ã–Ω iframe) -->
    <div id="qrScannerSite" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50">
        <div class="flex items-center justify-center h-full">
            <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                <div id="scannerContent">
                    <h2 class="text-2xl font-bold text-center mb-6">QR –°–∫–∞–Ω–µ—Ä</h2>
                    <div class="text-center">
                        <div id="validQR" class="hidden">
                            <div class="text-green-600 text-6xl mb-4">‚úÖ</div>
                            <p class="text-lg mb-6">QR –∫–æ–¥ –¥“±—Ä—ã—Å!</p>
                            <button id="confirmBtn" class="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-lg font-semibold">
                                –†–∞—Å—Ç–∞–π–º—ã–Ω
                            </button>
                        </div>
                        <div id="invalidQR" class="hidden">
                            <div class="text-red-600 text-6xl mb-4">‚ùå</div>
                            <p class="text-lg mb-6">QR –∫–æ–¥ –¥“±—Ä—ã—Å –µ–º–µ—Å! “ö–∞–π—Ç–∞ –∫”©—Ä—ñ“£—ñ–∑</p>
                            <button id="retryBtn" class="w-full py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-lg font-semibold">
                                “ö–∞–π—Ç–∞ –∫”©—Ä—É
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentStudents = [];
        let currentQRCode = '';
        let qrTimer = null;
        let timeLeft = 15;
        let confirmedStudents = new Set();

        // –°–∞“õ—Ç–∞–ª“ì–∞–Ω —Å—ã–Ω—ã–ø—Ç–∞—Ä
        let savedClasses = JSON.parse(localStorage.getItem('savedClasses') || '{}');

        // DOM —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä—ñ
        const homeBtn = document.getElementById('homeBtn');
        const smartMugalimBtn = document.getElementById('smartMugalimBtn');
        const topButtons = document.getElementById('topButtons');
        const listBtn = document.getElementById('listBtn');
        const qrBtn = document.getElementById('qrBtn');
        const geoBtn = document.getElementById('geoBtn');
        
        const mainContent = document.getElementById('mainContent');
        const listContent = document.getElementById('listContent');
        const qrContent = document.getElementById('qrContent');
        const geoContent = document.getElementById('geoContent');

        // –ë–∞—Å—Ç—ã –±–µ—Ç –±–∞—Ç—ã—Ä–º–∞—Å—ã
        homeBtn.addEventListener('click', () => {
            topButtons.classList.add('hidden');
            hideAllContent();
            mainContent.classList.remove('hidden');
            stopQRGeneration();
            setActiveSidebarButton(homeBtn);
        });

        // Smart Mugalim –±–∞—Ç—ã—Ä–º–∞—Å—ã–Ω –±–∞—Å—É
        smartMugalimBtn.addEventListener('click', () => {
            topButtons.classList.remove('hidden');
            showListContent();
            setActiveSidebarButton(smartMugalimBtn);
        });

        // –ñ–æ“ì–∞—Ä“ì—ã –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä
        listBtn.addEventListener('click', showListContent);
        qrBtn.addEventListener('click', showQRContent);
        geoBtn.addEventListener('click', showGeoContent);

        function showListContent() {
            hideAllContent();
            listContent.classList.remove('hidden');
            updateClassSelect();
            setActiveButton(listBtn);
        }

        function showQRContent() {
            hideAllContent();
            qrContent.classList.remove('hidden');
            setActiveButton(qrBtn);
            updateQRStudentsList();
            startQRGeneration();
        }

        function showGeoContent() {
            hideAllContent();
            geoContent.classList.remove('hidden');
            setActiveButton(geoBtn);
            stopQRGeneration();
        }

        function hideAllContent() {
            mainContent.classList.add('hidden');
            listContent.classList.add('hidden');
            qrContent.classList.add('hidden');
            geoContent.classList.add('hidden');
        }

        function setActiveButton(activeBtn) {
            [listBtn, qrBtn, geoBtn].forEach(btn => {
                btn.classList.remove('bg-blue-800', 'bg-green-800', 'bg-purple-800');
                if (btn === listBtn) btn.classList.add('bg-blue-600');
                if (btn === qrBtn) btn.classList.add('bg-green-600');
                if (btn === geoBtn) btn.classList.add('bg-purple-600');
            });
            
            if (activeBtn === listBtn) activeBtn.classList.add('bg-blue-800');
            if (activeBtn === qrBtn) activeBtn.classList.add('bg-green-800');
            if (activeBtn === geoBtn) activeBtn.classList.add('bg-purple-800');
        }

        function setActiveSidebarButton(activeBtn) {
            [homeBtn, smartMugalimBtn].forEach(btn => {
                btn.classList.remove('bg-gray-800');
            });
            activeBtn.classList.add('bg-gray-800');
        }

        // –°—ã–Ω—ã–ø —Å–∞“õ—Ç–∞—É
        document.getElementById('saveClassBtn').addEventListener('click', () => {
            const className = document.getElementById('classNameInput').value.trim();
            const studentsText = document.getElementById('studentsInput').value.trim();
            
            if (!className || !studentsText) {
                alert('–°—ã–Ω—ã–ø –∞—Ç–∞—É—ã –º–µ–Ω –æ“õ—É—à—ã–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ–Ω —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑!');
                return;
            }

            const students = studentsText.split('\n').filter(name => name.trim()).map(name => name.trim());
            
            savedClasses[className] = students;
            localStorage.setItem('savedClasses', JSON.stringify(savedClasses));
            
            currentStudents = students;
            confirmedStudents.clear();
            
            updateClassSelect();
            displayCurrentClass(className, students);
            
            alert('–°—ã–Ω—ã–ø —Å”ô—Ç—Ç—ñ —Å–∞“õ—Ç–∞–ª–¥—ã!');
        });

        // –°—ã–Ω—ã–ø –∂“Ø–∫—Ç–µ—É
        document.getElementById('loadClassBtn').addEventListener('click', () => {
            const selectedClass = document.getElementById('loadClassSelect').value;
            if (!selectedClass) {
                alert('–°—ã–Ω—ã–ø—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑!');
                return;
            }

            const students = savedClasses[selectedClass];
            currentStudents = students;
            confirmedStudents.clear();
            
            document.getElementById('classNameInput').value = selectedClass;
            document.getElementById('studentsInput').value = students.join('\n');
            
            displayCurrentClass(selectedClass, students);
        });

        function updateClassSelect() {
            const select = document.getElementById('loadClassSelect');
            select.innerHTML = '<option value="">–°–∞“õ—Ç–∞–ª“ì–∞–Ω —Å—ã–Ω—ã–ø—Ç—ã —Ç–∞“£–¥–∞—É</option>';
            
            Object.keys(savedClasses).forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                select.appendChild(option);
            });
        }

        function displayCurrentClass(className, students) {
            document.getElementById('currentClassName').textContent = className;
            const studentsList = document.getElementById('studentsList');
            
            studentsList.innerHTML = '';
            students.forEach(student => {
                const div = document.createElement('div');
                div.className = 'p-2 bg-gray-100 rounded text-center student-name';
                div.textContent = student;
                studentsList.appendChild(div);
            });
            
            document.getElementById('currentClassDisplay').classList.remove('hidden');
        }

        // QR –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è—Å—ã
        function generateQRCode() {
            currentQRCode = 'qr_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const canvas = document.getElementById('qrCanvas');
            
            // QR –∫–æ–¥ URL-—ñ–Ω “õ“±—Ä—É
            const qrUrl = `${window.location.origin}${window.location.pathname}?qr=${currentQRCode}`;
            
            // Canvas ”©–ª—à–µ–º—ñ–Ω –æ—Ä–Ω–∞—Ç—É
            canvas.width = 200;
            canvas.height = 200;
            
            QRCode.toCanvas(canvas, qrUrl, {
                width: 200,
                height: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, (error) => {
                if (error) {
                    console.error('QR –∫–æ–¥ “õ–∞—Ç–µ—Å—ñ:', error);
                    // “ö–∞—Ç–µ –±–æ–ª—Å–∞, –º”ô—Ç—ñ–Ω–º–µ–Ω –∫”©—Ä—Å–µ—Ç—É
                    const ctx = canvas.getContext('2d');
                    ctx.fillStyle = '#f3f4f6';
                    ctx.fillRect(0, 0, 200, 200);
                    ctx.fillStyle = '#374151';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('QR –∫–æ–¥ –∂“Ø–∫—Ç–µ–ª—É–¥–µ...', 100, 100);
                } else {
                    console.log('QR –∫–æ–¥ —Å”ô—Ç—Ç—ñ –∂–∞—Å–∞–ª–¥—ã:', currentQRCode);
                }
            });
        }

        function startQRGeneration() {
            generateQRCode();
            timeLeft = 15;
            updateTimer();
            
            qrTimer = setInterval(() => {
                timeLeft--;
                updateTimer();
                
                if (timeLeft <= 0) {
                    generateQRCode();
                    timeLeft = 15;
                }
            }, 1000);
        }

        function stopQRGeneration() {
            if (qrTimer) {
                clearInterval(qrTimer);
                qrTimer = null;
            }
        }

        function updateTimer() {
            document.getElementById('timer').textContent = timeLeft;
        }

        function updateQRStudentsList() {
            const container = document.getElementById('qrStudentsList');
            
            if (currentStudents.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 col-span-2 py-8">–ê–ª–¥—ã–º–µ–Ω —Ç—ñ–∑—ñ–º –±–µ—Ç—ñ–Ω–µ–Ω —Å—ã–Ω—ã–ø—Ç—ã –∂“Ø–∫—Ç–µ“£—ñ–∑</div>';
                return;
            }

            container.innerHTML = '';
            currentStudents.forEach(student => {
                const div = document.createElement('div');
                div.className = 'p-2 bg-gray-100 rounded text-center text-sm student-name';
                div.textContent = student;
                div.id = `qr-student-${student}`;
                
                if (confirmedStudents.has(student)) {
                    div.classList.add('student-confirmed');
                }
                
                container.appendChild(div);
            });
        }

        // QR —Å–∫–∞–Ω–µ—Ä —Å–∏–º—É–ª—è—Ü–∏—è—Å—ã (URL –ø–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä—ñ –∞—Ä“õ—ã–ª—ã)
        function checkQRFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const qrCode = urlParams.get('qr');
            
            if (qrCode) {
                // URL-–¥—ñ —Ç–∞–∑–∞–ª–∞—É
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // QR –∫–æ–¥—Ç—ã —Ç–µ–∫—Å–µ—Ä—É
                if (qrCode === currentQRCode) {
                    showQRScanner(true);
                } else {
                    showQRScanner(false);
                }
            }
        }

        function showQRScanner(isValid) {
            const scanner = document.getElementById('qrScannerSite');
            const validQR = document.getElementById('validQR');
            const invalidQR = document.getElementById('invalidQR');
            
            scanner.classList.remove('hidden');
            
            if (isValid) {
                validQR.classList.remove('hidden');
                invalidQR.classList.add('hidden');
            } else {
                validQR.classList.add('hidden');
                invalidQR.classList.remove('hidden');
            }
        }

        // –†–∞—Å—Ç–∞—É –±–∞—Ç—ã—Ä–º–∞—Å—ã
        document.getElementById('confirmBtn').addEventListener('click', () => {
            // –ë“±–ª –∂–µ—Ä–¥–µ –æ“õ—É—à—ã–Ω—ã“£ –µ—Å—ñ–º—ñ–Ω –∞–ª—É –∫–µ—Ä–µ–∫ (“õ–∞—Ä–∞–ø–∞–π—ã–º —Å–∏–º—É–ª—è—Ü–∏—è “Ø—à—ñ–Ω)
            const studentName = prompt('–°—ñ–∑–¥—ñ“£ –µ—Å—ñ–º—ñ“£—ñ–∑:');
            
            if (studentName && currentStudents.includes(studentName)) {
                confirmedStudents.add(studentName);
                updateQRStudentsList();
                
                // –¢—ñ–∑—ñ–º –±–µ—Ç—ñ–Ω–¥–µ–≥—ñ —Å—Ç—É–¥–µ–Ω—Ç—Ç—ñ –¥–µ –∂–∞“£–∞—Ä—Ç—É
                const listStudent = document.querySelector(`#studentsList .student-name:contains('${studentName}')`);
                if (listStudent) {
                    listStudent.classList.add('student-confirmed');
                }

                // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è–Ω—ã –∞–ª—É
                getStudentLocation(studentName);
                
                // –ê–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –±–µ—Ç—ñ–Ω–µ –∞—É—ã—Å—É
                setTimeout(() => {
                    showGeoContent();
                }, 1000);
            }
            
            document.getElementById('qrScannerSite').classList.add('hidden');
        });

        // “ö–∞–π—Ç–∞ –∫”©—Ä—É –±–∞—Ç—ã—Ä–º–∞—Å—ã
        document.getElementById('retryBtn').addEventListener('click', () => {
            document.getElementById('qrScannerSite').classList.add('hidden');
        });

        // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä—ã
        let studentLocations = {};

        function getStudentLocation(studentName) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const location = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: new Date().toLocaleString('kk-KZ')
                        };
                        
                        studentLocations[studentName] = location;
                        updateGeoStudentsList();
                    },
                    (error) => {
                        console.error('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è “õ–∞—Ç–µ—Å—ñ:', error);
                        studentLocations[studentName] = {
                            error: '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è–Ω—ã –∞–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã',
                            timestamp: new Date().toLocaleString('kk-KZ')
                        };
                        updateGeoStudentsList();
                    }
                );
            }
        }

        function updateGeoStudentsList() {
            const container = document.getElementById('geoStudentsList');
            
            if (Object.keys(studentLocations).length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">QR –∞—Ä“õ—ã–ª—ã —Ç—ñ—Ä–∫–µ–ª–≥–µ–Ω –æ“õ—É—à—ã–ª–∞—Ä –æ—Å—ã–Ω–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ</div>';
                return;
            }

            container.innerHTML = '';
            Object.entries(studentLocations).forEach(([studentName, location]) => {
                const div = document.createElement('div');
                div.className = 'bg-gray-50 p-4 rounded-lg border-l-4 border-green-500';
                
                if (location.error) {
                    div.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-semibold text-gray-800">${studentName}</h4>
                                <p class="text-sm text-red-600">${location.error}</p>
                                <p class="text-xs text-gray-500">${location.timestamp}</p>
                            </div>
                            <div class="text-red-500">‚ùå</div>
                        </div>
                    `;
                } else {
                    div.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-semibold text-gray-800">${studentName}</h4>
                                <p class="text-sm text-gray-600">üìç ${location.latitude.toFixed(6)}, ${location.longitude.toFixed(6)}</p>
                                <p class="text-xs text-gray-500">–î”ô–ª–¥—ñ–∫: ${Math.round(location.accuracy)}–º | ${location.timestamp}</p>
                            </div>
                            <div class="text-green-500">‚úÖ</div>
                        </div>
                    `;
                }
                
                container.appendChild(div);
            });
        }

        // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –±–∞—Ç—ã—Ä–º–∞—Å—ã
        document.getElementById('getLocationBtn').addEventListener('click', () => {
            if (navigator.geolocation) {
                document.getElementById('locationInfo').innerHTML = '<div class="text-center py-8"><div class="text-4xl mb-4">‚è≥</div><p class="text-gray-600">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∞–ª—ã–Ω—É–¥–∞...</p></div>';
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById('latitude').textContent = position.coords.latitude.toFixed(6);
                        document.getElementById('longitude').textContent = position.coords.longitude.toFixed(6);
                        document.getElementById('accuracy').textContent = Math.round(position.coords.accuracy);
                        document.getElementById('timestamp').textContent = new Date().toLocaleString('kk-KZ');
                        
                        document.getElementById('locationInfo').classList.add('hidden');
                        document.getElementById('locationDisplay').classList.remove('hidden');
                    },
                    (error) => {
                        document.getElementById('locationInfo').innerHTML = `
                            <div class="text-center py-8">
                                <div class="text-4xl mb-4">‚ùå</div>
                                <p class="text-red-600">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è–Ω—ã –∞–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã</p>
                                <p class="text-sm text-gray-500">${error.message}</p>
                                <button id="retryLocationBtn" class="mt-4 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    “ö–∞–π—Ç–∞ –∫”©—Ä—É
                                </button>
                            </div>
                        `;
                        
                        document.getElementById('retryLocationBtn').addEventListener('click', () => {
                            document.getElementById('getLocationBtn').click();
                        });
                    }
                );
            } else {
                alert('–°—ñ–∑–¥—ñ“£ –±—Ä–∞—É–∑–µ—Ä—ñ“£—ñ–∑ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è–Ω—ã “õ–æ–ª–¥–∞–º–∞–π–¥—ã');
            }
        });

        // –ë–µ—Ç—Ç—ñ –∂“Ø–∫—Ç–µ–≥–µ–Ω–¥–µ URL —Ç–µ–∫—Å–µ—Ä—É
        window.addEventListener('load', checkQRFromURL);
        
        // –ë–∞—Å—Ç–∞–ø“õ—ã –∫“Ø–π
        updateClassSelect();
        setActiveSidebarButton(homeBtn);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'984590ae365dece9',t:'MTc1ODc1MTMzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

