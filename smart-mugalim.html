<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Mugalim ‚Äî –¢“Ø–≥–µ–Ω–¥–µ—É</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* “ö–æ—Å—ã–º—à–∞ —Å—Ç–∏–ª—å–¥–µ—Ä (style.css –±–∞—Ä –±–æ–ª—Å–∞ –±—ñ—Ä—ñ–∫—Ç—ñ—Ä—ñ–ø “õ–∞–ª—É—ã –º“Ø–º–∫—ñ–Ω) */
    body{margin:0;font-family:Arial,Helvetica,sans-serif;display:flex;height:100vh}
    .sidebar{width:240px;background:#111827;color:#fff;padding:18px;display:flex;flex-direction:column}
    .sidebar h2{margin:0 0 18px 0}
    .nav-btn{background:none;border:none;color:#fff;padding:10px;text-align:left;cursor:pointer;border-radius:6px;margin-bottom:6px}
    .nav-btn:hover{background:#374151}
    .content{flex:1;padding:18px;display:flex;flex-direction:column;background:#f3f4f6;overflow:auto}
    .topbar{display:flex;gap:8px;margin-bottom:12px}
    .topbar button{padding:8px 12px;border-radius:6px;border:none;cursor:pointer;background:#2563eb;color:white}
    .topbar button.ghost{background:#e5e7eb;color:#111}
    .work{display:flex;gap:16px}
    .left-work{width:360px;background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.06)}
    .right-work{flex:1;background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.06)}
    .student-item{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;border-radius:6px;border:1px solid #eef2f7;margin-bottom:6px;background:#fbfdff}
    .student-item .del{background:#ef4444;border:none;color:white;padding:6px 8px;border-radius:6px;cursor:pointer}
    .saved-list-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;border:1px solid #e6eef8;margin-bottom:6px;background:#fff}
    .small{font-size:13px;color:#374151}
    input[type="text"]{padding:8px;border:1px solid #d1d5db;border-radius:6px;width:100%}
    textarea{width:100%;height:100px;padding:8px;border-radius:6px;border:1px solid #d1d5db}
    .muted{color:#6b7280;font-size:13px}
  </style>
</head>
<body>
  <!-- –°–æ–ª –∂–∞“õ –ø–∞–Ω–µ–ª—å (“±–¥–∞–π—ã –∫”©—Ä—ñ–Ω–µ—Ç—ñ–Ω) -->
  <div class="sidebar">
    <h2>Groowin</h2>
    <button class="nav-btn" onclick="location.href='index.html'">üè† –ë–∞—Å—Ç—ã –±–µ—Ç</button>
    <button class="nav-btn" onclick="location.href='smart-mugalim.html'">üë®üèª‚Äçüéì Smart Mugalim</button>
    <hr style="border:none;border-top:1px solid #26303a;margin:12px 0">
    <div class="small muted">–ù–∞–≤–∏–≥–∞—Ü–∏—è</div>
    <button class="nav-btn" onclick="showSection('tugen')">‚úÖ –¢“Ø–≥–µ–Ω–¥–µ—É</button>
    <!-- –ë–æ–ª–∞—à–∞“õ—Ç–∞ —Ç–∞“ì—ã –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä -->
  </div>

  <!-- –û“£ –∂–∞“õ –∂“±–º—ã—Å –∞–π–º–∞“ì—ã -->
  <div class="content">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
      <div>
        <h3 style="margin:0">Smart Mugalim ‚Äî –¢“Ø–≥–µ–Ω–¥–µ—É</h3>
        <div class="muted">–°–æ–ª –∂–∞“õ –±”©–ª–º–µ–¥–µ –Ω–∞–≤–∏–≥–∞—Ü–∏—è; –æ“£ –∂–∞“õ—Ç–∞ –∂“±–º—ã—Å –∞–π–º–∞“ì—ã</div>
      </div>
      <div class="muted">–ñ–∞“£–∞</div>
    </div>

    <!-- –ë–∞—Å—Ç—ã –∂–æ“ì–∞—Ä“ì—ã –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä (”ô—Ä–¥–∞–π—ã–º —Ç“±—Ä–∞–¥—ã) -->
    <div class="topbar">
      <button id="topListBtn">–¢—ñ–∑—ñ–º</button>
      <button id="topQRBtn" class="ghost">QR</button>
      <button id="topGeoBtn" class="ghost">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</button>
    </div>

    <!-- –ñ“±–º—ã—Å –∞–π–º–∞“ì—ã: —Ç—ñ–∑—ñ–º/qr/–≥–µ–æ -->
    <div class="work">
      <!-- –°–æ–ª –∂–∞“õ—Ç–∞“ì—ã —à–∞“ì—ã–Ω –±–∞—Å“õ–∞—Ä—É (—Å—ã–Ω—ã–ø –∞—Ç–∞—É—ã, –∏–º–ø–æ—Ä—Ç, —Å–∞“õ—Ç–∞–ª“ì–∞–Ω —Ç—ñ–∑—ñ–º–¥–µ—Ä) -->
      <div class="left-work">
        <h4 style="margin-top:0">–°—ã–Ω—ã–ø / –°–ø–∏—Å–æ–∫</h4>
        <label class="small">–°—ã–Ω—ã–ø –∞—Ç–∞—É—ã</label>
        <input id="className" type="text" placeholder="–ú—ã—Å: 8A" style="margin-bottom:8px"/>

        <label class="small">–û“õ—É—à—ã “õ–æ—Å—É (Enter –±–∞—Å—ã–ø “õ–æ—Å—ã“£—ã–∑)</label>
        <input id="nameInput" type="text" placeholder="–ê—Ç—ã-–∂”©–Ω—ñ –∂”ô–Ω–µ Enter" />

        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="addNameBtn" class="topbar" style="padding:8px 10px;background:#10b981;color:white;border-radius:6px">“ö–æ—Å—É</button>
          <button id="saveClassBtn" style="padding:8px 10px;border-radius:6px;background:#2563eb;color:white;border:none">–°–∞“õ—Ç–∞—É</button>
          <button id="clearCurrentBtn" style="padding:8px 10px;border-radius:6px;background:#ef4444;color:white;border:none">–¢–∞–∑–∞–ª–∞—É</button>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f7"/>

        <h4 style="margin:0 0 8px 0">–¢—ñ–∑—ñ–º–¥–µ—Ä</h4>
        <div id="savedLists" style="max-height:340px;overflow:auto"></div>
      </div>

      <!-- –û“£ –∂–∞“õ: –Ω–µ–≥—ñ–∑–≥—ñ –∂“±–º—ã—Å –±”©–ª—ñ–≥—ñ (—Ç—ñ–∑—ñ–º –∫”©—Ä—ñ–Ω—ñ—Å—ñ) -->
      <div class="right-work">
        <!-- –¢—ñ–∑—ñ–º -->
        <div id="listSection" class="section">
          <h4 style="margin-top:0">–ê“ì—ã–º–¥–∞“ì—ã —Ç—ñ–∑—ñ–º</h4>
          <div id="currentClassName" class="muted">–°—ã–Ω—ã–ø: ‚Äî</div>
          <div id="currentNames" style="margin-top:10px"></div>
          <div style="margin-top:12px" class="muted">(–ê—Ç—Ç–∞—Ä–¥—ã –µ–Ω–≥—ñ–∑—É “Ø—à—ñ–Ω –∂–∞–Ω—ã“£—ã–∑–¥–∞“ì—ã ”©—Ä—ñ—Å—Ç—ñ “õ–æ–ª–¥–∞–Ω—ã“£—ã–∑, Enter –±–∞—Å“õ–∞–Ω–¥–∞ “õ–æ—Å—ã–ª–∞–¥—ã.)</div>
        </div>

        <!-- QR (”ô–∑—ñ—Ä—à–µ –±–æ—Å) -->
        <div id="qrSection" class="section" style="display:none">
          <h4>QR</h4>
          <p class="muted">QR –∂“±–º—ã—Å—ã–Ω –∫–µ–π—ñ–Ω “õ–æ—Å–∞–º—ã–∑ ‚Äî “õ–∞–∑—ñ—Ä —Ç–µ—Å—Ç—Ç—ñ–∫ —Ä–µ–∂–∏–º.</p>
        </div>

        <!-- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è (–±–æ—Å) -->
        <div id="geoSection" class="section" style="display:none">
          <h4>–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</h4>
          <p class="muted">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∫–µ–π—ñ–Ω “õ–æ—Å—ã–ª–∞–¥—ã.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase (Realtime DB v8) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    /*****  FIREBASE CONFIG (—Å–µ–Ω –±–µ—Ä–≥–µ–Ω)  *****/
    const firebaseConfig = {
      apiKey: "AIzaSyDP2SHjJQYzu_lhWUbk1NBN6H65mR5YI_s",
      authDomain: "groowin-attendance.firebaseapp.com",
      projectId: "groowin-attendance",
      storageBucket: "groowin-attendance.firebasestorage.app",
      messagingSenderId: "737566994771",
      appId: "1:737566994771:web:982cf9e32e968229f2b1a6",
      measurementId: "G-WJXHCBGJBN"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    /***** UI state *****/
    let currentNames = [];        // –∞“ì—ã–º–¥–∞“ì—ã –µ–Ω–≥—ñ–∑—ñ–ª–≥–µ–Ω –æ“õ—É—à—ã–ª–∞—Ä
    let currentClass = "";        // –∞“ì—ã–º–¥–∞“ì—ã —Å—ã–Ω—ã–ø –∞—Ç–∞—É—ã

    // –≠–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä
    const nameInput = () => document.getElementById('nameInput');
    const classNameInput = () => document.getElementById('className');
    const currentNamesDiv = () => document.getElementById('currentNames');
    const currentClassNameEl = () => document.getElementById('currentClassName');
    const savedListsDiv = () => document.getElementById('savedLists');

    // –ë–∞—Å—Ç–∞–ø“õ—ã –æ—Ä–Ω–∞—Ç—É
    window.onload = () => {
      // –Ω–∞–≤–∏–≥–∞—Ü–∏—è / –∂–æ“ì–∞—Ä“ì—ã –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä
      document.getElementById('topListBtn').onclick = () => { showOnly('list'); loadSavedLists(); };
      document.getElementById('topQRBtn').onclick = () => { showOnly('qr'); };
      document.getElementById('topGeoBtn').onclick = () => { showOnly('geo'); };

      // —Å–æ–ª –∂–∞“õ –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä—ã
      document.getElementById('addNameBtn').onclick = addNameFromInput;
      document.getElementById('saveClassBtn').onclick = saveClass;
      document.getElementById('clearCurrentBtn').onclick = clearCurrent;

      // Enter-–ø–µ–Ω “õ–æ—Å—É
      document.getElementById('nameInput').addEventListener('keydown', function(e){
        if(e.key === 'Enter'){ e.preventDefault(); addNameFromInput(); }
      });

      // –∂“Ø–∫—Ç–µ—É
      showSection('tugen'); // —Å–æ–ª –∂–∞“õ—Ç—ã“£ '–¢“Ø–≥–µ–Ω–¥–µ—É' –∫”©—Ä—Å–µ—Ç—ñ–ª–≥–µ–Ω –±–æ–ª—É—ã
      showOnly('list');     // –æ“£ –∂–∞“õ—Ç–∞ ”ô—É–µ–ª–≥—ñ—Å—ñ ‚Äî —Ç—ñ–∑—ñ–º
      loadSavedLists();
    };

    /* UI –∫”©—Ä—Å–µ—Ç—É/–∂–∞—Å—ã—Ä—É */
    function showSection(name){
      // —Ç–µ–∫ —ñ—à–∫—ñ –∂“±–º—ã—Å –∞–π–º–∞“ì—ã–Ω –±–µ–ª—Å–µ–Ω–¥–µ–Ω–¥—ñ—Ä—É (–ø–∞—Ä–∞“õ —ñ—à—ñ–Ω–¥–µ–≥—ñ —Å–µ–∫—Ü–∏—è)
      // but left sidebar always visible ‚Äî we only ensure tugen is active
      // (we kept only one feature now)
      // nothing special here for left panel: it's static
      // left '–¢“Ø–≥–µ–Ω–¥–µ—É' already active
    }

    function showOnly(tab){
      document.getElementById('listSection').style.display = (tab==='list') ? 'block' : 'none';
      document.getElementById('qrSection').style.display = (tab==='qr') ? 'block' : 'none';
      document.getElementById('geoSection').style.display = (tab==='geo') ? 'block' : 'none';
      // highlight top buttons simple effect
      ['topListBtn','topQRBtn','topGeoBtn'].forEach(id=>{
        document.getElementById(id).classList.remove('active');
      });
    }

    /* –ê—Ç—ã–Ω “õ–æ—Å—É (input –∞—Ä“õ—ã–ª—ã) */
    function addNameFromInput(){
      const v = nameInput().value.trim();
      if(!v) return;
      currentNames.push(v);
      nameInput().value = '';
      renderCurrentNames();
    }

    function renderCurrentNames(){
      const cont = currentNamesDiv();
      cont.innerHTML = '';
      currentNames.forEach((nm, i) => {
        const el = document.createElement('div');
        el.className = 'student-item';
        el.innerHTML = `<div>${nm}</div>`;
        const del = document.createElement('button');
        del.className = 'del';
        del.textContent = '”®—à—ñ—Ä—É';
        del.onclick = () => {
          currentNames.splice(i,1);
          renderCurrentNames();
        };
        el.appendChild(del);
        cont.appendChild(el);
      });
      currentClassNameEl().textContent = currentClass ? ('–°—ã–Ω—ã–ø: ' + currentClass) : '–°—ã–Ω—ã–ø: ‚Äî';
    }

    /* –°–∞“õ—Ç–∞—É —Å—ã–Ω—ã–ø“õ–∞ */
    function saveClass(){
      const cls = classNameInput().value.trim();
      if(!cls) return alert('–°—ã–Ω—ã–ø –∞—Ç–∞—É—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑');
      if(currentNames.length === 0) return alert('–ê—Ç—Ç–∞—Ä –∂–æ“õ ‚Äî –∞–ª–¥—ã–º–µ–Ω –æ“õ—É—à—ã–ª–∞—Ä–¥—ã “õ–æ—Å—ã“£—ã–∑');
      // —Å–∞“õ—Ç–∞–π–º—ã–∑: /lists/{cls} = { names: [...] , created: timestamp }
      db.ref('lists/' + cls).set({
        names: currentNames,
        created: Date.now()
      }).then(()=>{
        currentClass = cls;
        // –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ saved lists –∞–π–º–∞“ì—ã–Ω –∂–∞“£–∞—Ä—Ç—É
        loadSavedLists();
        renderCurrentNames();
        alert('–°–∞“õ—Ç–∞–ª–¥—ã: ' + cls);
      }).catch(err=>{ alert('“ö–∞—Ç–µ: ' + err.message) });
    }

    /* –¢–∞–∑–∞–ª–∞—É –∞“ì—ã–º–¥–∞“ì—ã */
    function clearCurrent(){
      if(!confirm('–ê“ì—ã–º–¥–∞“ì—ã –µ–Ω–≥—ñ–∑—ñ–ª–≥–µ–Ω —Ç—ñ–∑—ñ–º–¥—ñ —Ç–∞–∑–∞–ª–∞—É?')) return;
      currentNames = [];
      currentClass = '';
      classNameInput().value = '';
      renderCurrentNames();
    }

    /* saved lists –∂“Ø–∫—Ç–µ—É –∂”ô–Ω–µ –∫”©—Ä—Å–µ—Ç—É ‚Äî –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ —à—ã“ì–∞–¥—ã */
    function loadSavedLists(){
      savedListsDiv().innerHTML = '';
      db.ref('lists').once('value').then(snap=>{
        const val = snap.val() || {};
        const keys = Object.keys(val);
        if(keys.length === 0){
          savedListsDiv().innerHTML = '<div class="muted small">–°–∞“õ—Ç–∞–ª“ì–∞–Ω —Ç—ñ–∑—ñ–º–¥–µ—Ä –∂–æ“õ</div>';
          return;
        }
        // ”ô—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
        keys.forEach(k=>{
          const node = val[k];
          const div = document.createElement('div');
          div.className = 'saved-list-item';
          const left = document.createElement('div');
          left.innerHTML = `<strong>${k}</strong><div class="small muted">(${(node.names||[]).length} –æ“õ—É—à—ã)</div>`;
          const right = document.createElement('div');
          right.style.display = 'flex';
          right.style.gap = '8px';
          const loadBtn = document.createElement('button');
          loadBtn.textContent = '–ñ“Ø–∫—Ç–µ—É';
          loadBtn.onclick = ()=> loadList(k);
          const delBtn = document.createElement('button');
          delBtn.textContent = '–ñ–æ—é';
          delBtn.style.background='#ef4444'; delBtn.style.color='white'; delBtn.style.border='none'; delBtn.style.padding='6px 8px'; delBtn.style.borderRadius='6px';
          delBtn.onclick = ()=> {
            if(!confirm('–°—ñ–∑ —Ç—ñ–∑—ñ–º–¥—ñ –∂–æ–π“ì—ã“£—ã–∑ –∫–µ–ª–µ–¥—ñ –º–µ?')) return;
            db.ref('lists/' + k).remove().then(()=>{ loadSavedLists(); if(currentClass===k){ currentClass=''; currentNames=[]; renderCurrentNames(); }});
          };
          right.appendChild(loadBtn);
          right.appendChild(delBtn);
          div.appendChild(left);
          div.appendChild(right);
          savedListsDiv().appendChild(div);
        });
      });
    }

    /* –±—ñ—Ä —Å–∞“õ—Ç–∞–ª“ì–∞–Ω —Ç—ñ–∑—ñ–º–¥—ñ –∂“Ø–∫—Ç–µ—É (–∫”©—Ä—Å–µ—Ç—É –æ“£ –∂–∞“õ—Ç–∞) */
    function loadList(name){
      db.ref('lists/' + name).once('value').then(snap=>{
        const data = snap.val();
        const arr = (data && data.names) || [];
        currentNames = arr.slice(); // –∫”©—à—ñ—Ä—ñ–ø –∞–ª–∞–º—ã–∑
        currentClass = name;
        classNameInput().value = name;
        renderCurrentNames();
        // –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ —Ç—ñ–∑—ñ–º –∫”©—Ä—ñ–Ω—ñ—Å—ñ–Ω –∫”©—Ä—Å–µ—Ç
        showOnly('list');
      });
    }

  </script>
</body>
</html>
